<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orbit Simulator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000;
            min-height: 100vh;
            overflow: hidden;
            color: white;
        }
        #canvas {
            display: block;
            background: #000;
            cursor: crosshair;
        }
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .slider-group {
            margin: 10px 0;
        }
        .slider-group label {
            display: block;
            font-size: 11px;
            margin-bottom: 5px;
            opacity: 0.8;
        }
        input[type="range"] {
            width: 180px;
            height: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            border-radius: 2px;
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #f90;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(255, 153, 0, 0.5);
        }
        input[type="range"]::-moz-range-thumb {
            width: 14px;
            height: 14px;
            background: #f90;
            cursor: pointer;
            border-radius: 50%;
            border: none;
            box-shadow: 0 0 5px rgba(255, 153, 0, 0.5);
        }
        .value {
            display: inline-block;
            width: 40px;
            text-align: right;
            font-weight: bold;
            color: #f90;
            font-size: 11px;
        }
        .nav {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        .nav a {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            text-decoration: none;
            color: white;
            font-size: 11px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }
        .nav a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        .info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            font-size: 11px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 300px;
        }
        .info-line {
            margin: 4px 0;
            opacity: 0.8;
        }
        button {
            margin: 5px 5px 5px 0;
            padding: 6px 12px;
            background: #f90;
            border: none;
            border-radius: 5px;
            color: black;
            cursor: pointer;
            font-weight: bold;
            font-size: 11px;
            transition: all 0.3s;
        }
        button:hover {
            background: #fa0;
            transform: scale(1.05);
        }
        .title {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px;
            font-weight: 800;
            color: rgba(255, 255, 255, 0.05);
            letter-spacing: 8px;
            pointer-events: none;
            user-select: none;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="title">ORBITAL</div>

    <div class="controls">
        <div class="slider-group">
            <label>Mass: <span class="value" id="massVal">50</span></label>
            <input type="range" id="mass" min="10" max="200" value="50" step="1">
        </div>
        <div class="slider-group">
            <label>G Constant: <span class="value" id="gVal">2</span></label>
            <input type="range" id="gConst" min="0.1" max="5" value="2" step="0.1">
        </div>
        <button id="clear">CLEAR</button>
        <button id="preset1">Earth</button>
        <button id="preset2">Binary</button>
    </div>

    <div class="nav">
        <a href="index.html">Projectile</a>
        <a href="collision.html">Collisions</a>
        <a href="pendulum.html">Pendulum</a>
        <a href="../index.html">Hub</a>
    </div>

    <div class="info">
        <div class="info-line">Click to place satellites</div>
        <div class="info-line">Drag to set velocity</div>
        <div class="info-line">Bodies: <span id="count">1</span></div>
    </div>

    <script>
        console.log('VELOCITY: Orbit simulator initialized');

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        let centralMass = 50;
        let G = 2;
        let bodies = [];
        let trails = [];
        let dragging = null;
        let dragStart = null;

        // Central body (sun/planet)
        const sun = {
            x: centerX,
            y: centerY,
            mass: 1000,
            fixed: true
        };

        // Sliders
        document.getElementById('mass').addEventListener('input', (e) => {
            centralMass = parseFloat(e.target.value);
            document.getElementById('massVal').textContent = centralMass;
        });

        document.getElementById('gConst').addEventListener('input', (e) => {
            G = parseFloat(e.target.value);
            document.getElementById('gVal').textContent = G;
        });

        document.getElementById('clear').addEventListener('click', () => {
            bodies = [];
            trails = [];
            updateCount();
        });

        document.getElementById('preset1').addEventListener('click', () => {
            bodies = [];
            trails = [];
            bodies.push({
                x: centerX + 200,
                y: centerY,
                vx: 0,
                vy: 8,
                mass: 10,
                trail: []
            });
            updateCount();
        });

        document.getElementById('preset2').addEventListener('click', () => {
            bodies = [];
            trails = [];
            bodies.push({
                x: centerX + 150,
                y: centerY,
                vx: 0,
                vy: 6,
                mass: 10,
                trail: []
            });
            bodies.push({
                x: centerX - 150,
                y: centerY,
                vx: 0,
                vy: -6,
                mass: 10,
                trail: []
            });
            updateCount();
        });

        // Mouse interaction
        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const distToSun = Math.sqrt((x - sun.x) ** 2 + (y - sun.y) ** 2);
            if (distToSun < 40) return; // Don't place on sun

            dragging = { x, y };
            dragStart = { x, y };
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!dragging) return;
            const rect = canvas.getBoundingClientRect();
            dragging.x = e.clientX - rect.left;
            dragging.y = e.clientY - rect.top;
        });

        canvas.addEventListener('mouseup', (e) => {
            if (!dragging || !dragStart) return;

            const rect = canvas.getBoundingClientRect();
            const endX = e.clientX - rect.left;
            const endY = e.clientY - rect.top;

            const vx = (endX - dragStart.x) * 0.1;
            const vy = (endY - dragStart.y) * 0.1;

            bodies.push({
                x: dragStart.x,
                y: dragStart.y,
                vx: vx,
                vy: vy,
                mass: centralMass,
                trail: []
            });

            dragging = null;
            dragStart = null;
            updateCount();
            console.log(`ORBIT: Body added at (${dragStart.x}, ${dragStart.y}) with v=(${vx}, ${vy})`);
        });

        function updateCount() {
            document.getElementById('count').textContent = bodies.length + 1;
        }

        function animate() {
            // Clear background
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw stars
            ctx.fillStyle = 'rgba(255, 255, 255, 0.15)';
            for (let i = 0; i < 150; i++) {
                const x = (i * 123.456) % canvas.width;
                const y = (i * 789.012) % canvas.height;
                const size = (i % 3) === 0 ? 2 : 1;
                ctx.fillRect(x, y, size, size);
            }

            // Draw orbital grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.lineWidth = 1;
            for (let r = 100; r < 600; r += 100) {
                ctx.beginPath();
                ctx.arc(sun.x, sun.y, r, 0, Math.PI * 2);
                ctx.stroke();
            }

            // Update physics
            for (const body of bodies) {
                // Gravity from sun
                let dx = sun.x - body.x;
                let dy = sun.y - body.y;
                let dist = Math.sqrt(dx * dx + dy * dy);
                if (dist < 5) dist = 5; // Prevent singularity

                let force = (G * sun.mass * body.mass) / (dist * dist);
                let ax = (force / body.mass) * (dx / dist);
                let ay = (force / body.mass) * (dy / dist);

                // Gravity from other bodies
                for (const other of bodies) {
                    if (other === body) continue;
                    dx = other.x - body.x;
                    dy = other.y - body.y;
                    dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 10) continue; // Avoid collision chaos

                    force = (G * other.mass * body.mass) / (dist * dist);
                    ax += (force / body.mass) * (dx / dist);
                    ay += (force / body.mass) * (dy / dist);
                }

                body.vx += ax * 0.016;
                body.vy += ay * 0.016;
                body.x += body.vx;
                body.y += body.vy;

                // Trail
                body.trail.push({ x: body.x, y: body.y });
                if (body.trail.length > 500) body.trail.shift();
            }

            // Draw trails with gradient
            for (const body of bodies) {
                if (body.trail.length > 1) {
                    for (let i = 1; i < body.trail.length; i++) {
                        const alpha = (i / body.trail.length) * 0.6;
                        ctx.strokeStyle = `rgba(100, 200, 255, ${alpha})`;
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(body.trail[i-1].x, body.trail[i-1].y);
                        ctx.lineTo(body.trail[i].x, body.trail[i].y);
                        ctx.stroke();
                    }
                }
            }

            // Draw sun with pulse effect
            const time = performance.now() * 0.001;
            const pulse = Math.sin(time * 2) * 0.1 + 1;

            const sunGrad = ctx.createRadialGradient(sun.x, sun.y, 0, sun.x, sun.y, 50 * pulse);
            sunGrad.addColorStop(0, '#fff');
            sunGrad.addColorStop(0.3, '#ff0');
            sunGrad.addColorStop(0.6, '#f80');
            sunGrad.addColorStop(1, 'rgba(255, 100, 0, 0)');
            ctx.fillStyle = sunGrad;
            ctx.beginPath();
            ctx.arc(sun.x, sun.y, 50 * pulse, 0, Math.PI * 2);
            ctx.fill();

            // Sun core
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(sun.x, sun.y, 18, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#ff0';
            ctx.beginPath();
            ctx.arc(sun.x, sun.y, 22, 0, Math.PI * 2);
            ctx.fill();

            // Draw bodies
            for (const body of bodies) {
                // Glow
                const bodyGrad = ctx.createRadialGradient(body.x, body.y, 0, body.x, body.y, 15);
                bodyGrad.addColorStop(0, 'rgba(100, 150, 255, 0.8)');
                bodyGrad.addColorStop(1, 'rgba(100, 150, 255, 0)');
                ctx.fillStyle = bodyGrad;
                ctx.beginPath();
                ctx.arc(body.x, body.y, 15, 0, Math.PI * 2);
                ctx.fill();

                // Core
                ctx.fillStyle = '#4af';
                ctx.beginPath();
                ctx.arc(body.x, body.y, 5, 0, Math.PI * 2);
                ctx.fill();

                // Velocity vector
                ctx.strokeStyle = 'rgba(255, 100, 100, 0.5)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(body.x, body.y);
                ctx.lineTo(body.x + body.vx * 3, body.y + body.vy * 3);
                ctx.stroke();
            }

            // Draw drag preview
            if (dragging && dragStart) {
                ctx.strokeStyle = 'rgba(255, 255, 100, 0.6)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(dragStart.x, dragStart.y);
                ctx.lineTo(dragging.x, dragging.y);
                ctx.stroke();
                ctx.setLineDash([]);

                // Arrow
                const angle = Math.atan2(dragging.y - dragStart.y, dragging.x - dragStart.x);
                ctx.fillStyle = 'rgba(255, 255, 100, 0.6)';
                ctx.beginPath();
                ctx.moveTo(dragging.x, dragging.y);
                ctx.lineTo(dragging.x - 10 * Math.cos(angle - 0.3), dragging.y - 10 * Math.sin(angle - 0.3));
                ctx.lineTo(dragging.x - 10 * Math.cos(angle + 0.3), dragging.y - 10 * Math.sin(angle + 0.3));
                ctx.closePath();
                ctx.fill();

                // Preview body
                ctx.fillStyle = 'rgba(100, 150, 255, 0.5)';
                ctx.beginPath();
                ctx.arc(dragStart.x, dragStart.y, 5, 0, Math.PI * 2);
                ctx.fill();
            }

            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        animate();
        updateCount();
        console.log('VELOCITY: Orbit simulation started at 60fps');
    </script>
</body>
</html>
