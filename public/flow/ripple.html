<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ripple Tank</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: #001a33;
  overflow: hidden;
  font-family: system-ui, -apple-system, sans-serif;
}

canvas {
  display: block;
  width: 100%;
  height: 100vh;
}

.nav {
  position: fixed;
  top: 20px;
  left: 20px;
  display: flex;
  gap: 10px;
  z-index: 10;
}

.nav a {
  padding: 8px 16px;
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  color: white;
  text-decoration: none;
  border-radius: 20px;
  font-size: 12px;
  transition: all 0.3s;
  border: 1px solid rgba(255,255,255,0.2);
}

.nav a:hover {
  background: rgba(255,255,255,0.2);
  transform: translateY(-2px);
}

.info {
  position: fixed;
  bottom: 20px;
  left: 20px;
  color: rgba(255,255,255,0.6);
  font-size: 11px;
}
</style>
</head>
<body>
<div class="nav">
  <a href="index.html">Fluid</a>
  <a href="smoke.html">Smoke</a>
  <a href="ripple.html">Ripple</a>
  <a href="wind.html">Wind</a>
  <a href="../index.html">Hub</a>
</div>

<div class="info">Click to create ripples</div>

<canvas id="canvas"></canvas>

<script>
console.log('RIPPLE TANK - Wave interference simulation');

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d', { alpha: false });

let width, height, cols, rows;
const resolution = 3;
let current = [];
let previous = [];
let dampening = 0.99;

function resize() {
  width = canvas.width = window.innerWidth;
  height = canvas.height = window.innerHeight;
  cols = Math.floor(width / resolution);
  rows = Math.floor(height / resolution);

  current = Array(cols * rows).fill(0);
  previous = Array(cols * rows).fill(0);
  console.log(`Ripple grid: ${cols}x${rows} cells`);
}

window.addEventListener('resize', resize);
resize();

function idx(x, y) {
  return y * cols + x;
}

function addRipple(x, y, amplitude) {
  const col = Math.floor(x / resolution);
  const row = Math.floor(y / resolution);

  if (col > 0 && col < cols - 1 && row > 0 && row < rows - 1) {
    current[idx(col, row)] = amplitude;
  }
}

canvas.addEventListener('click', (e) => {
  addRipple(e.clientX, e.clientY, 255);
});

canvas.addEventListener('touchstart', (e) => {
  e.preventDefault();
  addRipple(e.touches[0].clientX, e.touches[0].clientY, 255);
});

let time = 0;
const sources = [];
for (let i = 0; i < 3; i++) {
  sources.push({
    x: width * (0.25 + i * 0.25),
    y: height * 0.5,
    phase: i * Math.PI * 0.66,
    freq: 0.05 + i * 0.02
  });
}

let lastTime = Date.now();

function animate() {
  const now = Date.now();
  const dt = Math.min((now - lastTime) / 1000, 0.05);
  lastTime = now;
  time += dt;

  for (let i = 0; i < sources.length; i++) {
    const s = sources[i];
    s.y = height * (0.5 + Math.sin(time * 0.3 + s.phase) * 0.2);
    const wave = Math.sin(time * s.freq * 50) * 150;
    addRipple(s.x, s.y, wave);
  }

  for (let x = 1; x < cols - 1; x++) {
    for (let y = 1; y < rows - 1; y++) {
      const i = idx(x, y);
      current[i] = (
        previous[idx(x - 1, y)] +
        previous[idx(x + 1, y)] +
        previous[idx(x, y - 1)] +
        previous[idx(x, y + 1)]
      ) / 2 - current[i];
      current[i] *= dampening;
    }
  }

  [previous, current] = [current, previous];

  const imageData = ctx.createImageData(width, height);
  const data = imageData.data;

  for (let i = 0; i < width; i++) {
    for (let j = 0; j < height; j++) {
      const col = Math.floor(i / resolution);
      const row = Math.floor(j / resolution);
      const wave = previous[idx(col, row)];

      const pixelIndex = (j * width + i) * 4;
      const brightness = Math.abs(wave);
      const hue = 200 + wave * 0.3;

      if (wave > 0) {
        data[pixelIndex] = Math.min(255, brightness * 0.5);
        data[pixelIndex + 1] = Math.min(255, brightness * 1.2);
        data[pixelIndex + 2] = 255;
      } else {
        data[pixelIndex] = 0;
        data[pixelIndex + 1] = Math.max(0, 80 + wave * 0.8);
        data[pixelIndex + 2] = Math.max(30, 120 + wave * 0.8);
      }
      data[pixelIndex + 3] = 255;
    }
  }

  ctx.putImageData(imageData, 0, 0);
  requestAnimationFrame(animate);
}

animate();
console.log('Wave simulation running');
</script>
</body>
</html>
